const axios = require("axios");

module.exports = {
    config: {
        name: "admininfo",
        aliases: [],
        version: "1.0.1",
        author: "ğ– ğ—Œğ—‚ğ–¿ ğ–¬ğ–ºğ—ğ—†ğ—ğ–½",
        countDown: 5,
        role: 0,
        category: "info",
        shortDescription: {
            en: "ğ–²ğ—ğ—ˆğ—ğ—Œ ğ–»ğ—ˆğ— ğ–ºğ–½ğ—†ğ—‚ğ—‡ ğ—‚ğ—‡ğ–¿ğ—ˆğ—‹ğ—†ğ–ºğ—ğ—‚ğ—ˆğ—‡"
        },
        longDescription: {
            en: "ğ–£ğ—‚ğ—Œğ—‰ğ—…ğ–ºğ—’ğ—Œ ğ—ğ—ğ–¾ ğ–»ğ—ˆğ— ğ–ºğ–½ğ—†ğ—‚ğ—‡ğ—‚ğ—Œğ—ğ—‹ğ–ºğ—ğ—ˆğ—‹'ğ—Œ ğ—‚ğ—‡ğ–¿ğ—ˆğ—‹ğ—†ğ–ºğ—ğ—‚ğ—ˆğ—‡"
        },
        guide: {
            en: "{p}admininfo"
        },
        dependencies: {
            "axios": ""
        }
    },

    onStart: async function({ message }) {
        try {
            // ğŸ›¡ï¸ Dependency check
            let axiosAvailable = true;
            try {
                require("axios");
            } catch (e) {
                axiosAvailable = false;
            }

            if (!axiosAvailable) {
                return await this.sendTextOnly(message);
            }

            const profileImageURL = 'https://graph.facebook.com/61571630409265/picture?width=720&height=720&access_token=6628568379%7Cc1e620fa708a1d5696fb991c1bde5662';
            
            let imageStream = null;
            let imageSuccess = false;

            // ğŸ›¡ï¸ Try to get image stream with multiple attempts
            for (let attempt = 1; attempt <= 3; attempt++) {
                try {
                    console.log(`ğŸ–¼ï¸ ğ–¨ğ—†ğ–ºğ—€ğ–¾ ğ—Œğ—ğ—‹ğ–¾ğ–ºğ—† ğ–ºğ—ğ—ğ–¾ğ—†ğ—‰ğ— ${attempt}`);
                    imageStream = await global.utils.getStreamFromURL(profileImageURL);
                    
                    if (imageStream) {
                        imageSuccess = true;
                        console.log(`âœ… ğ–¨ğ—†ğ–ºğ—€ğ–¾ ğ—Œğ—ğ—‹ğ–¾ğ–ºğ—† ğ—Œğ—ğ–¼ğ–¼ğ–¾ğ—Œğ—Œ ğ–ºğ—ğ—ğ–¾ğ—†ğ—‰ğ— ${attempt}`);
                        break;
                    }
                } catch (streamError) {
                    console.log(`âŒ ğ–¨ğ—†ğ–ºğ—€ğ–¾ ğ—Œğ—ğ—‹ğ–¾ğ–ºğ—† ğ–ºğ—ğ—ğ–¾ğ—†ğ—‰ğ— ${attempt} ğ–¿ğ–ºğ—‚ğ—…ğ–¾ğ–½:`, streamError.message);
                    
                    if (attempt === 3) {
                        console.log(`ğŸ”„ ğ– ğ—…ğ—… ğ—‚ğ—†ğ–ºğ—€ğ–¾ ğ–ºğ—ğ—ğ–¾ğ—†ğ—‰ğ—ğ—Œ ğ–¿ğ–ºğ—‚ğ—…ğ–¾ğ–½, ğ—ğ—Œğ—‚ğ—‡ğ—€ ğ—ğ–¾ğ—‘ğ— ğ—ˆğ—‡ğ—…ğ—’`);
                    }
                }
            }

            if (imageSuccess && imageStream) {
                await message.reply({
                    body: `â•”â•â•â•â•â•â—†â—†â—†â—†â—†â•â•â•â•—

ğ—”ğ——ğ— ğ—œğ—¡ ğ—œğ—¡ğ—™ğ—¢ğ—¥ğ— ğ—”ğ—§ğ—œğ—¢ğ—¡

â•šâ•â•â•â•â•â—†â—†â—†â—†â—†â•â•â•â•

ğŸ‘‘ ğ—¡ğ—®ğ—ºğ—²: ğ– ğ—Œğ—‚ğ–¿ ğ–¬ğ–ºğ—ğ—†ğ—ğ–½
ğŸ“§ ğ—™ğ—®ğ—°ğ—²ğ—¯ğ—¼ğ—¼ğ—¸: ğ–¿ğ–ºğ–¼ğ–¾ğ–»ğ—ˆğ—ˆğ—„.ğ–¼ğ—ˆğ—†/ğ—Œğ—ğ–ºğ—‹ğ–¾/ğŸ£ğŸ§ğ—’ğ–µğ—‚ğ—ˆğ–°ğ–°ğ—’ğ—Š/
ğŸ“± ğ—£ğ—µğ—¼ğ—»ğ—²: +ğŸ´ğŸ´ğŸ¬ğŸ­ğŸ±ğŸ´ğŸ²ğŸ°ğŸ¬ğŸ¬ğŸ±ğŸµğŸ¬
ğŸ¯ ğ—¥ğ—¼ğ—¹ğ—²: ğ–¡ğ—ˆğ— ğ–®ğ—ğ—‡ğ–¾ğ—‹ & ğ–£ğ–¾ğ—ğ–¾ğ—…ğ—ˆğ—‰ğ–¾ğ—‹

â•”â•â•â•â•â•â—†â—†â—†â—†â—†â•â•â•â•—

ğ—–ğ—¢ğ—¡ğ—§ğ—”ğ—–ğ—§ ğ——ğ—˜ğ—§ğ—”ğ—œğ—Ÿğ—¦

â•šâ•â•â•â•â•â—†â—†â—†â—†â—†â•â•â•â•

ğŸ’¬ ğ—”ğ˜ƒğ—®ğ—¶ğ—¹ğ—®ğ—¯ğ—¶ğ—¹ğ—¶ğ˜ğ˜†: ğŸ®ğŸ°/ğŸ³
ğŸ“ ğ—¥ğ—²ğ˜€ğ—½ğ—¼ğ—»ğ˜€ğ—² ğ—§ğ—¶ğ—ºğ—²: ğ–¶ğ—‚ğ—ğ—ğ—‚ğ—‡ ğŸ£ğŸ¤ ğ—ğ—ˆğ—ğ—‹ğ—Œ
ğŸ”§ ğ—¦ğ˜‚ğ—½ğ—½ğ—¼ğ—¿ğ˜: ğ–¡ğ—ˆğ— ğ–¨ğ—Œğ—Œğ—ğ–¾ğ—Œ & ğ–¥ğ–¾ğ–ºğ—ğ—ğ—‹ğ–¾ğ—Œ

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğ—•ğ—¢ğ—§ ğ—¢ğ—ªğ—¡ğ—˜ğ—¥: ğ– ğ—Œğ—‚ğ–¿ ğ–¬ğ–ºğ—ğ—†ğ—ğ–½
ğ—–ğ—¥ğ—˜ğ—”ğ—§ğ—¢ğ—¥ & ğ——ğ—˜ğ—©ğ—˜ğ—Ÿğ—¢ğ—£ğ—˜ğ—¥

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`,
                    attachment: imageStream
                });
            } else {
                // ğŸ›¡ï¸ Fallback to text-only version
                await this.sendTextOnly(message);
            }
            
        } catch (error) {
            console.error("ğŸ’¥ ğ– ğ–½ğ—†ğ—‚ğ—‡ ğ—‚ğ—‡ğ–¿ğ—ˆ ğ—†ğ–ºğ—‚ğ—‡ ğ–¾ğ—‹ğ—‹ğ—ˆğ—‹:", error);
            // ğŸ›¡ï¸ Final fallback
            await this.sendTextOnly(message);
        }
    },

    // ğŸ›¡ï¸ Text-only fallback function
    sendTextOnly: async function(message) {
        try {
            await message.reply(`â•”â•â•â•â•â•â—†â—†â—†â—†â—†â•â•â•â•—

ğ—”ğ——ğ— ğ—œğ—¡ ğ—œğ—¡ğ—™ğ—¢ğ—¥ğ— ğ—”ğ—§ğ—œğ—¢ğ—¡

â•šâ•â•â•â•â•â—†â—†â—†â—†â—†â•â•â•â•

ğŸ‘‘ ğ—¡ğ—®ğ—ºğ—²: ğ– ğ—Œğ—‚ğ–¿ ğ–¬ğ–ºğ—ğ—†ğ—ğ–½
ğŸ“§ ğ—™ğ—®ğ—°ğ—²ğ—¯ğ—¼ğ—¼ğ—¸: ğ–¿ğ–ºğ–¼ğ–¾ğ–»ğ—ˆğ—ˆğ—„.ğ–¼ğ—ˆğ—†/ğ—Œğ—ğ–ºğ—‹ğ–¾/ğŸ£ğŸ§ğ—’ğ–µğ—‚ğ—ˆğ–°ğ–°ğ—’ğ—Š/
ğŸ“± ğ—£ğ—µğ—¼ğ—»ğ—²: +ğŸ´ğŸ´ğŸ¬ğŸ­ğŸ±ğŸ´ğŸ²ğŸ°ğŸ¬ğŸ¬ğŸ±ğŸµğŸ¬
ğŸ¯ ğ—¥ğ—¼ğ—¹ğ—²: ğ–¡ğ—ˆğ— ğ–®ğ—ğ—‡ğ–¾ğ—‹ & ğ–£ğ–¾ğ—ğ–¾ğ—…ğ—ˆğ—‰ğ–¾ğ—‹

â•”â•â•â•â•â•â—†â—†â—†â—†â—†â•â•â•â•—

ğ—–ğ—¢ğ—¡ğ—§ğ—”ğ—–ğ—§ ğ——ğ—˜ğ—§ğ—”ğ—œğ—Ÿğ—¦

â•šâ•â•â•â•â•â—†â—†â—†â—†â—†â•â•â•â•

ğŸ’¬ ğ—”ğ˜ƒğ—®ğ—¶ğ—¹ğ—®ğ—¯ğ—¶ğ—¹ğ—¶ğ˜ğ˜†: ğŸ®ğŸ°/ğŸ³
ğŸ“ ğ—¥ğ—²ğ˜€ğ—½ğ—¼ğ—»ğ˜€ğ—² ğ—§ğ—¶ğ—ºğ—²: ğ–¶ğ—‚ğ—ğ—ğ—‚ğ—‡ ğŸ£ğŸ¤ ğ—ğ—ˆğ—ğ—‹ğ—Œ
ğŸ”§ ğ—¦ğ˜‚ğ—½ğ—½ğ—¼ğ—¿ğ˜: ğ–¡ğ—ˆğ— ğ–¨ğ—Œğ—Œğ—ğ–¾ğ—Œ & ğ–¥ğ–¾ğ–ºğ—ğ—ğ—‹ğ–¾ğ—Œ

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğ—•ğ—¢ğ—§ ğ—¢ğ—ªğ—¡ğ—˜ğ—¥: ğ– ğ—Œğ—‚ğ–¿ ğ–¬ğ–ºğ—ğ—†ğ—ğ–½
ğ—–ğ—¥ğ—˜ğ—”ğ—§ğ—¢ğ—¥ & ğ——ğ—˜ğ—©ğ—˜ğ—Ÿğ—¢ğ—£ğ—˜ğ—‹

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`);
        } catch (fallbackError) {
            console.error("ğŸ’¥ ğ–³ğ–¾ğ—‘ğ— ğ—ˆğ—‡ğ—…ğ—’ ğ–¿ğ–ºğ—…ğ—…ğ–»ğ–ºğ–¼ğ—„ ğ–¾ğ—‹ğ—‹ğ—ˆğ—‹:", fallbackError);
            // ğŸ›¡ï¸ Ultimate fallback - simple message
            try {
                await message.reply("ğŸ‘‘ ğ–¡ğ—ˆğ— ğ–®ğ—ğ—‡ğ–¾ğ—‹: ğ– ğ—Œğ—‚ğ–¿ ğ–¬ğ–ºğ—ğ—†ğ—ğ–½\nğŸ“ ğ–¢ğ—ˆğ—‡ğ—ğ–ºğ–¼ğ—: +ğŸ´ğŸ´ğŸ¬ğŸ­ğŸ±ğŸ´ğŸ²ğŸ°ğŸ¬ğŸ¬ğŸ±ğŸµğŸ¬\nğŸ”§ ğ–±ğ—ˆğ—…ğ–¾: ğ–£ğ–¾ğ—ğ–¾ğ—…ğ—ˆğ—‰ğ–¾ğ—‹ & ğ–¬ğ–ºğ—‚ğ—‡ğ—ğ–ºğ—‚ğ—‡ğ–¾ğ—‹");
            } catch (finalError) {
                console.error("ğŸ’¥ ğ–¥ğ—‚ğ—‡ğ–ºğ—… ğ–¿ğ–ºğ—…ğ—…ğ–»ğ–ºğ–¼ğ—„ ğ–¾ğ—‹ğ—‹ğ—ˆğ—‹:", finalError);
            }
        }
    }
};
