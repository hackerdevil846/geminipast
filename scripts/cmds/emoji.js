module.exports = {
    config: {
        name: "emoji",
        aliases: [],
        version: "1.0.0",
        author: "ğ´ğ‘ ğ‘–ğ‘“ ğ‘€ğ‘â„ğ‘šğ‘¢ğ‘‘",
        countDown: 5,
        role: 0,
        category: "tool",
        shortDescription: {
            en: "ğ–¤ğ—†ğ—ˆğ—ƒğ—‚ ğ—†ğ–¾ğ—Œğ—Œğ–ºğ—€ğ–¾ ğ–¾ğ—‡ğ–¼ğ—‹ğ—’ğ—‰ğ—ğ—‚ğ—ˆğ—‡ ğ–ºğ—‡ğ–½ ğ–½ğ–¾ğ–¼ğ—‹ğ—’ğ—‰ğ—ğ—‚ğ—ˆğ—‡"
        },
        longDescription: {
            en: "ğ–¤ğ—‡ğ–¼ğ—ˆğ–½ğ–¾ ğ–ºğ—‡ğ–½ ğ–½ğ–¾ğ–¼ğ—ˆğ–½ğ–¾ ğ—†ğ–¾ğ—Œğ—Œğ–ºğ—€ğ–¾ğ—Œ ğ—ğ—Œğ—‚ğ—‡ğ—€ ğ–¾ğ—†ğ—ˆğ—ƒğ—‚ğ—Œ"
        },
        guide: {
            en: "{p}emoji ğ–¾ğ—‡ <ğ—ğ–¾ğ—‘ğ—>\n{p}emoji ğ–½ğ–¾ <ğ—ğ–¾ğ—‘ğ—>"
        }
    },

    onStart: async function({ message, args, event }) {
        try {
            const { threadID, messageID } = event;
            
            if (args.length < 2) {
                return message.reply(`âœ¨ ğ–´ğ—Œğ–ºğ—€ğ–¾:\n${this.config.guide.en}`);
            }

            const type = args[0].toLowerCase();
            const text = args.slice(1).join(" ").toLowerCase();

            // Validate input length
            if (text.length === 0) {
                return message.reply("âŒ ğ–¯ğ—…ğ–¾ğ–ºğ—Œğ–¾ ğ—‰ğ—‹ğ—ˆğ—ğ—‚ğ–½ğ–¾ ğ—ğ–¾ğ—‘ğ— ğ—ğ—ˆ ğ–¾ğ—‡ğ–¼ğ—ˆğ–½ğ–¾/ğ–½ğ–¾ğ–¼ğ—ˆğ–½ğ–¾");
            }

            if (text.length > 1000) {
                return message.reply("âŒ ğ–³ğ–¾ğ—‘ğ— ğ—‚ğ—Œ ğ—ğ—ˆğ—ˆ ğ—…ğ—ˆğ—‡ğ—€. ğ–¬ğ–ºğ—‘ğ—‚ğ—†ğ—ğ—† 1000 ğ–¼ğ—ğ–ºğ—‹ğ–ºğ–¼ğ—ğ–¾ğ—‹ğ—Œ ğ–ºğ—…ğ—…ğ—ˆğ—ğ–¾ğ–½.");
            }

            if (type === 'encode' || type === 'en') {
                const mapping = {
                    'Ã |Ã¡|áº¡|áº£|Ã£|Ã¢|áº§|áº¥|áº­|áº©|áº«|Äƒ|áº±|áº¯|áº·|áº³|áºµ|a': 'ğŸ˜€',
                    'b': 'ğŸ˜ƒ',
                    'c': 'ğŸ˜',
                    'Ä‘|d': 'ğŸ˜…',
                    'Ã¨|Ã©|áº¹|áº»|áº½|Ãª|á»|áº¿|á»‡|á»ƒ|á»…|e': 'ğŸ¥°',
                    'f': 'ğŸ¤£',
                    'g': 'ğŸ¥²',
                    'h': 'â˜ºï¸',
                    'Ã¬|Ã­|á»‹|á»‰|Ä©|i': 'ğŸ˜Š',
                    'k': 'ğŸ˜‡',
                    'l': 'ğŸ˜‰',
                    'm': 'ğŸ˜’',
                    'n': 'ğŸ˜',
                    'Ã²|Ã³|á»|á»|Ãµ|Ã´|á»“|á»‘|á»™|á»•|á»—|Æ¡|á»|á»›|á»£|á»Ÿ|á»¡|o': 'ğŸ˜™',
                    'p': 'ğŸ˜Ÿ',
                    'q': 'ğŸ˜•',
                    'r': 'ğŸ™‚',
                    's': 'ğŸ™ƒ',
                    't': 'â˜¹ï¸',
                    'Ã¹|Ãº|á»¥|á»§|Å©|Æ°|á»«|á»©|á»±|á»­|á»¯|u': 'ğŸ˜¡',
                    'v': 'ğŸ˜',
                    'x': 'ğŸ˜©',
                    'á»³|Ã½|á»µ|á»·|á»¹|y': 'ğŸ˜­',
                    'w': 'ğŸ˜³',
                    'z': 'ğŸ˜ ',
                    ' ': '.',
                    '0': '0ï¸âƒ£',
                    '1': '1ï¸âƒ£',
                    '2': '2ï¸âƒ£',
                    '3': '3ï¸âƒ£',
                    '4': '4ï¸âƒ£',
                    '5': '5ï¸âƒ£',
                    '6': '6ï¸âƒ£',
                    '7': '7ï¸âƒ£',
                    '8': '8ï¸âƒ£',
                    '9': '9ï¸âƒ£'
                };

                let encoded = text;
                
                try {
                    for (const [key, emoji] of Object.entries(mapping)) {
                        try {
                            const regex = new RegExp(key, 'gi');
                            encoded = encoded.replace(regex, emoji);
                        } catch (regexError) {
                            console.warn(`âŒ ğ–±ğ–¾ğ—€ğ–¾ğ—‘ ğ–¾ğ—‹ğ—‹ğ—ˆğ—‹ ğ–¿ğ—ˆğ—‹ ${key}:`, regexError.message);
                            continue;
                        }
                    }
                    
                    // Remove diacritics safely
                    encoded = encoded.replace(/[\u0300\u0301\u0303\u0309\u0323]/g, "")
                                     .replace(/[\u02C6\u0306\u031B]/g, "");

                    // Validate result
                    if (encoded.length === 0) {
                        throw new Error("ğ–¤ğ—‡ğ–¼ğ—ˆğ–½ğ—‚ğ—‡ğ—€ ğ—‹ğ–¾ğ—Œğ—ğ—…ğ—ğ–¾ğ–½ ğ—‚ğ—‡ ğ–¾ğ—†ğ—‰ğ—ğ—’ ğ—Œğ—ğ—‹ğ—‚ğ—‡ğ—€");
                    }

                    return message.reply(`ğŸ” ğ–¤ğ—‡ğ–¼ğ—ˆğ–½ğ–¾ğ–½ ğ–²ğ—ğ–¼ğ–¼ğ–¾ğ—Œğ—Œğ–¿ğ—ğ—…ğ—…ğ—’ âœ¨\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”\n${encoded}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”`);

                } catch (encodeError) {
                    console.error("ğŸ’¥ ğ–¤ğ—‡ğ–¼ğ—ˆğ–½ğ—‚ğ—‡ğ—€ ğ–¾ğ—‹ğ—‹ğ—ˆğ—‹:", encodeError);
                    return message.reply("âŒ ğ–¥ğ–ºğ—‚ğ—…ğ–¾ğ–½ ğ—ğ—ˆ ğ–¾ğ—‡ğ–¼ğ—ˆğ–½ğ–¾ ğ—ğ–¾ğ—‘ğ—. ğ–¯ğ—…ğ–¾ğ–ºğ—Œğ–¾ ğ—ğ—‹ğ—’ ğ–ºğ—€ğ–ºğ—‚ğ—‡ ğ—ğ—‚ğ—ğ— ğ–½ğ—‚ğ–¿ğ–¿ğ–¾ğ—‹ğ–¾ğ—‡ğ— ğ—ğ–¾ğ—‘ğ—.");
                }

            } 
            else if (type === 'decode' || type === 'de') {
                const mapping = {
                    'ğŸ˜€': 'a',
                    'ğŸ˜ƒ': 'b',
                    'ğŸ˜': 'c',
                    'ğŸ˜…': 'd',
                    'ğŸ¥°': 'e',
                    'ğŸ¤£': 'f',
                    'ğŸ¥²': 'g',
                    'â˜ºï¸': 'h',
                    'ğŸ˜Š': 'i',
                    'ğŸ˜‡': 'k',
                    'ğŸ˜‰': 'l',
                    'ğŸ˜’': 'm',
                    'ğŸ˜': 'n',
                    'ğŸ˜™': 'o',
                    'ğŸ˜Ÿ': 'p',
                    'ğŸ˜•': 'q',
                    'ğŸ™‚': 'r',
                    'ğŸ™ƒ': 's',
                    'â˜¹ï¸': 't',
                    'ğŸ˜¡': 'u',
                    'ğŸ˜': 'v',
                    'ğŸ˜©': 'x',
                    'ğŸ˜­': 'y',
                    'ğŸ˜³': 'w',
                    'ğŸ˜ ': 'z',
                    '\\.': ' ',
                    '0ï¸âƒ£': '0',
                    '1ï¸âƒ£': '1',
                    '2ï¸âƒ£': '2',
                    '3ï¸âƒ£': '3',
                    '4ï¸âƒ£': '4',
                    '5ï¸âƒ£': '5',
                    '6ï¸âƒ£': '6',
                    '7ï¸âƒ£': '7',
                    '8ï¸âƒ£': '8',
                    '9ï¸âƒ£': '9'
                };

                let decoded = text;
                
                try {
                    for (const [emoji, char] of Object.entries(mapping)) {
                        try {
                            const escapedEmoji = emoji.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                            const regex = new RegExp(escapedEmoji, 'g');
                            decoded = decoded.replace(regex, char);
                        } catch (regexError) {
                            console.warn(`âŒ ğ–±ğ–¾ğ—€ğ–¾ğ—‘ ğ–¾ğ—‹ğ—‹ğ—ˆğ—‹ ğ–¿ğ—ˆğ—‹ ${emoji}:`, regexError.message);
                            continue;
                        }
                    }

                    // Validate result
                    if (decoded.length === 0) {
                        throw new Error("ğ–£ğ–¾ğ–¼ğ—ˆğ–½ğ—‚ğ—‡ğ—€ ğ—‹ğ–¾ğ—Œğ—ğ—…ğ—ğ–¾ğ–½ ğ—‚ğ—‡ ğ–¾ğ—†ğ—‰ğ—ğ—’ ğ—Œğ—ğ—‹ğ—‚ğ—‡ğ—€");
                    }

                    return message.reply(`ğŸ”“ ğ–£ğ–¾ğ–¼ğ—ˆğ–½ğ–¾ğ–½ ğ–²ğ—ğ–¼ğ–¼ğ–¾ğ—Œğ—Œğ–¿ğ—ğ—…ğ—…ğ—’ âœ¨\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”\n${decoded}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”`);

                } catch (decodeError) {
                    console.error("ğŸ’¥ ğ–£ğ–¾ğ–¼ğ—ˆğ–½ğ—‚ğ—‡ğ—€ ğ–¾ğ—‹ğ—‹ğ—ˆğ—‹:", decodeError);
                    return message.reply("âŒ ğ–¥ğ–ºğ—‚ğ—…ğ–¾ğ–½ ğ—ğ—ˆ ğ–½ğ–¾ğ–¼ğ—ˆğ–½ğ–¾ ğ—ğ–¾ğ—‘ğ—. ğ–¯ğ—…ğ–¾ğ–ºğ—Œğ–¾ ğ–¼ğ—ğ–¾ğ–¼ğ—„ ğ—‚ğ–¿ ğ—ğ—ğ–¾ ğ—ğ–¾ğ—‘ğ— ğ—‚ğ—Œ ğ–¾ğ—†ğ—ˆğ—ƒğ—‚-ğ–¾ğ—‡ğ–¼ğ—ˆğ–½ğ–¾ğ–½.");
                }

            } 
            else {
                return message.reply(`âŒ ğ–¨ğ—‡ğ—ğ–ºğ—…ğ—‚ğ–½ ğ–®ğ—‰ğ–¾ğ—‹ğ–ºğ—ğ—‚ğ—ˆğ—‡\nâœ¨ ğ–´ğ—Œğ–ºğ—€ğ–¾:\n${this.config.guide.en}`);
            }

        } catch (error) {
            console.error("ğŸ’¥ ğ–¤ğ—†ğ—ˆğ—ƒğ—‚ ğ–¼ğ—ˆğ—†ğ—†ğ–ºğ—‡ğ–½ ğ–¾ğ—‹ğ—‹ğ—ˆğ—‹:", error);
            return message.reply("âŒ ğ– ğ—‡ ğ–¾ğ—‹ğ—‹ğ—ˆğ—‹ ğ—ˆğ–¼ğ–¼ğ—ğ—‹ğ—‹ğ–¾ğ–½. ğ–¯ğ—…ğ–¾ğ–ºğ—Œğ–¾ ğ—ğ—‹ğ—’ ğ–ºğ—€ğ–ºğ—‚ğ—‡ ğ—…ğ–ºğ—ğ–¾ğ—‹.");
        }
    }
};
