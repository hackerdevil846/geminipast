module.exports = {
    config: {
        name: "celebrate",
        aliases: [],
        version: "1.4.0",
        author: "ğ´ğ‘ ğ‘–ğ‘“ ğ‘€ğ‘â„ğ‘šğ‘¢ğ‘‘",
        countDown: 60,
        role: 0,
        category: "fun",
        shortDescription: {
            en: "ğ–²ğ—ğ–ºğ—‹ğ— ğ–º ğ—ƒğ—ˆğ—’ğ–¿ğ—ğ—… ğ–¼ğ–¾ğ—…ğ–¾ğ–»ğ—‹ğ–ºğ—ğ—‚ğ—ˆğ—‡ ğ—‚ğ—‡ ğ–¼ğ—ğ–ºğ—"
        },
        longDescription: {
            en: "ğ–²ğ—ğ–ºğ—‹ğ— ğ–º ğ—ƒğ—ˆğ—’ğ–¿ğ—ğ—… ğ–¼ğ–¾ğ—…ğ–¾ğ–»ğ—‹ğ–ºğ—ğ—‚ğ—ˆğ—‡ ğ—‚ğ—‡ ğ–¼ğ—ğ–ºğ— ğ—ğ—‚ğ—ğ— ğ—‚ğ—‡ğ—ğ–¾ğ—‹ğ–ºğ–¼ğ—ğ—‚ğ—ğ–¾ ğ—†ğ–¾ğ—Œğ—Œğ–ºğ—€ğ–¾ğ—Œ ğ–ºğ—‡ğ–½ ğ–¾ğ—†ğ—ˆğ—ƒğ—‚ğ—Œ"
        },
        guide: {
            en: "{p}celebrate [@ğ—†ğ–¾ğ—‡ğ—ğ—‚ğ—ˆğ—‡ ğ—ˆğ—‹ ğ—‡ğ–ºğ—†ğ–¾]"
        }
    },

    onStart: async function({ message, event, args, api }) {
        try {
            const { threadID, mentions, senderID } = event;
            let celebrationActive = true;

            // Function to safely send messages with error handling
            const safeSendMessage = async (text) => {
                if (!celebrationActive) return;
                try {
                    await message.reply(text);
                    return true;
                } catch (error) {
                    console.error("âŒ ğ–¥ğ–ºğ—‚ğ—…ğ–¾ğ–½ ğ—ğ—ˆ ğ—Œğ–¾ğ—‡ğ–½ ğ–¼ğ–¾ğ—…ğ–¾ğ–»ğ—‹ğ–ºğ—ğ—‚ğ—ˆğ—‡ ğ—†ğ–¾ğ—Œğ—Œğ–ºğ—€ğ–¾:", error.message);
                    return false;
                }
            };

            // Determine who to celebrate
            let name = "ğ–¾ğ—ğ–¾ğ—‹ğ—’ğ—ˆğ—‡ğ–¾";
            let isMentioned = false;

            if (Object.keys(mentions).length > 0) {
                const mentionedID = Object.keys(mentions)[0];
                name = mentions[mentionedID].replace(/@/g, "").trim();
                isMentioned = true;
            } else if (args.length > 0) {
                name = args.join(" ").trim();
            }

            // Validate name length
            if (name.length > 50) {
                name = name.substring(0, 47) + "...";
            }

            if (name.length === 0) {
                name = "ğ–¾ğ—ğ–¾ğ—‹ğ—’ğ—ˆğ—‡ğ–¾";
            }

            console.log(`ğŸ‰ ğ–²ğ—ğ–ºğ—‹ğ—ğ—‚ğ—‡ğ—€ ğ–¼ğ–¾ğ—…ğ–¾ğ–»ğ—‹ğ–ºğ—ğ—‚ğ—ˆğ—‡ ğ–¿ğ—ˆğ—‹: ${name}`);

            // Initial message
            const initialSent = await safeSendMessage(
                `ğŸ‰ ğ–«ğ–¤ğ–³'ğ–² ğ–¢ğ–¤ğ–«ğ–¤ğ–¡ğ–±ğ– ğ–³ğ–¤ ${name.toUpperCase()}! ğŸ‰\n` +
                "â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n" +
                `ğ–¦ğ–¾ğ— ğ—‹ğ–¾ğ–ºğ–½ğ—’ ğ–¿ğ—ˆğ—‹ ğ–ºğ—‡ 80-ğ—Œğ–¾ğ–¼ğ—ˆğ—‡ğ–½ ğ–¼ğ–¾ğ—…ğ–¾ğ–»ğ—‹ğ–ºğ—ğ—‚ğ—ˆğ—‡ ${isMentioned ? 'ğ—ğ—‚ğ—ğ— ğ—Œğ—‰ğ–¾ğ–¼ğ—‚ğ–ºğ—… ğ—†ğ–¾ğ—‡ğ—ğ—‚ğ—ˆğ—‡ğ—Œ!' : 'ğ–¿ğ—ğ—…ğ—… ğ—ˆğ–¿ ğ—ƒğ—ˆğ—’!'}\n` +
                "ğŸˆ ğ–¬ğ–¾ğ—Œğ—Œğ–ºğ—€ğ–¾ğ—Œ ğ—ğ—‚ğ—…ğ—… ğ–ºğ—‰ğ—‰ğ–¾ğ–ºğ—‹ ğ–¾ğ—ğ–¾ğ—‹ğ—’ 3 ğ—Œğ–¾ğ–¼ğ—ˆğ—‡ğ–½ğ—Œ..."
            );

            if (!initialSent) {
                console.error("âŒ ğ–¥ğ–ºğ—‚ğ—…ğ–¾ğ–½ ğ—ğ—ˆ ğ—Œğ—ğ–ºğ—‹ğ— ğ–¼ğ–¾ğ—…ğ–¾ğ–»ğ—‹ğ–ºğ—ğ—‚ğ—ˆğ—‡");
                return;
            }

            // Celebration messages with delays
            const celebrationMessages = [
                {delay: 3, msg: "ğŸ‡ ğ–«ğ–¾ğ— ğ—ğ—ğ–¾ ğ–¼ğ–¾ğ—…ğ–¾ğ–»ğ—‹ğ–ºğ—ğ—‚ğ—ˆğ—‡ ğ–»ğ–¾ğ—€ğ—‚ğ—‡! ğŸ‡"},
                {delay: 6, msg: `ğŸŒŸ ${name} ğ—‚ğ—Œ ğ—ğ—ğ–¾ ğ—Œğ—ğ–ºğ—‹ ğ—ˆğ–¿ ğ—ğ—ğ–¾ ğ—Œğ—ğ—ˆğ—! ğŸŒŸ`},
                {delay: 9, msg: "âœ¨ ğ–¯ğ—ˆğ—Œğ—‚ğ—ğ—‚ğ—ğ–¾ ğ—ğ—‚ğ–»ğ–¾ğ—Œ ğ—ˆğ—‡ğ—…ğ—’! âœ¨"},
                {delay: 12, msg: "ğŸ¥³ ğ–³ğ—‚ğ—†ğ–¾ ğ—ğ—ˆ ğ–½ğ–ºğ—‡ğ–¼ğ–¾! ğŸ•ºğŸ’ƒ"},
                {delay: 15, msg: "ğŸˆ ğ–«ğ–¾ğ—'ğ—Œ ğ—Œğ—‰ğ—‹ğ–¾ğ–ºğ–½ ğ—ƒğ—ˆğ—’ ğ–ºğ—‡ğ–½ ğ—ğ–ºğ—‰ğ—‰ğ—‚ğ—‡ğ–¾ğ—Œğ—Œ! ğŸˆ"},
                {delay: 18, msg: "ğŸŒˆ ğ–«ğ—‚ğ–¿ğ–¾ ğ—‚ğ—Œ ğ–»ğ–¾ğ–ºğ—ğ—ğ—‚ğ–¿ğ—ğ—…! ğŸŒˆ"},
                {delay: 21, msg: `ğŸ’– ğ–¸ğ—ˆğ—'ğ—‹ğ–¾ ğ–ºğ—†ğ–ºğ—“ğ—‚ğ—‡ğ—€, ${name}! ğŸ’–`},
                {delay: 24, msg: "ğŸŠ ğ–¢ğ–¾ğ—…ğ–¾ğ–»ğ—‹ğ–ºğ—ğ—‚ğ—ˆğ—‡ ğ—ğ—‚ğ—†ğ–¾! ğŸŠ"},
                {delay: 27, msg: "ğŸ¥‚ ğ–¢ğ—ğ–¾ğ–¾ğ—‹ğ—Œ ğ—ğ—ˆ ğ—€ğ—ˆğ—ˆğ–½ ğ—ğ—‚ğ—†ğ–¾ğ—Œ! ğŸ¥‚"},
                {delay: 30, msg: "ğŸŒ  ğ–¬ğ–ºğ—„ğ–¾ ğ–º ğ—ğ—‚ğ—Œğ—! ğŸŒ "},
                {delay: 33, msg: "ğŸµ ğ–¬ğ—ğ—Œğ—‚ğ–¼ ğ—†ğ–ºğ—„ğ–¾ğ—Œ ğ–¾ğ—ğ–¾ğ—‹ğ—’ğ—ğ—ğ—‚ğ—‡ğ—€ ğ–»ğ–¾ğ—ğ—ğ–¾ğ—‹! ğŸµ"},
                {delay: 36, msg: "ğŸ˜Š ğ–²ğ—†ğ—‚ğ—…ğ–¾ - ğ—‚ğ—'ğ—Œ ğ–¼ğ—ˆğ—‡ğ—ğ–ºğ—€ğ—‚ğ—ˆğ—ğ—Œ! ğŸ˜Š"},
                {delay: 39, msg: `ğŸŒŸ ğ–²ğ—ğ—‚ğ—‡ğ–¾ ğ–»ğ—‹ğ—‚ğ—€ğ—ğ— ğ—…ğ—‚ğ—„ğ–¾ ğ–º ğ–½ğ—‚ğ–ºğ—†ğ—ˆğ—‡ğ–½, ${name}! ğŸŒŸ`},
                {delay: 42, msg: "ğŸ•Šï¸ ğ–¯ğ–¾ğ–ºğ–¼ğ–¾ ğ–ºğ—‡ğ–½ ğ—…ğ—ˆğ—ğ–¾ ğ—ğ—ˆ ğ–ºğ—…ğ—…! ğŸ•Šï¸"},
                {delay: 45, msg: "ğŸ™Œ ğ–¦ğ—‹ğ—ˆğ—ğ—‰ ğ—ğ—ğ—€ ğ—ğ—‚ğ—†ğ–¾! ğŸ¤—"},
                {delay: 48, msg: "ğŸ ğ–²ğ—ğ—‹ğ—‰ğ—‹ğ—‚ğ—Œğ–¾! ğ–¸ğ—ˆğ—'ğ—‹ğ–¾ ğ–ºğ—ğ–¾ğ—Œğ—ˆğ—†ğ–¾! ğŸ"},
                {delay: 51, msg: "ğŸ’« ğ–¬ğ–ºğ—€ğ—‚ğ–¼ğ–ºğ—… ğ—†ğ—ˆğ—†ğ–¾ğ—‡ğ—ğ—Œ ğ—ğ—‚ğ—ğ— ğ–¿ğ—‹ğ—‚ğ–¾ğ—‡ğ–½ğ—Œ! ğŸ’«"},
                {delay: 54, msg: "ğŸ¤ ğ–«ğ–¾ğ—'ğ—Œ ğ—Œğ—‚ğ—‡ğ—€ ğ—ğ—ˆğ—€ğ–¾ğ—ğ—ğ–¾ğ—‹! ğŸ¶"},
                {delay: 57, msg: "ğŸŒ» ğ–²ğ—‰ğ—‹ğ–¾ğ–ºğ–½ ğ—„ğ—‚ğ—‡ğ–½ğ—‡ğ–¾ğ—Œğ—Œ ğ—…ğ—‚ğ—„ğ–¾ ğ—Œğ—ğ—‡ğ—Œğ—ğ—‚ğ—‡ğ–¾! ğŸŒ»"},
                {delay: 60, msg: `ğŸ† ğ–¸ğ—ˆğ—'ğ—‹ğ–¾ ğ–º ğ—ğ—‚ğ—‡ğ—‡ğ–¾ğ—‹, ${name}! ğŸ†`},
                {delay: 63, msg: "ğŸ¨ ğ–«ğ—‚ğ–¿ğ–¾ ğ—‚ğ—Œ ğ—’ğ—ˆğ—ğ—‹ ğ–¼ğ–ºğ—‡ğ—ğ–ºğ—Œ - ğ—‰ğ–ºğ—‚ğ—‡ğ— ğ—‚ğ— ğ–»ğ—‹ğ—‚ğ—€ğ—ğ—! ğŸ¨"},
                {delay: 66, msg: "ğŸ¤ ğ–³ğ—ˆğ—€ğ–¾ğ—ğ—ğ–¾ğ—‹ ğ—ğ–¾'ğ—‹ğ–¾ ğ—Œğ—ğ—‹ğ—ˆğ—‡ğ—€ğ–¾ğ—‹! ğŸ¤"},
                {delay: 69, msg: "ğŸŒ ğ–¬ğ–ºğ—„ğ–¾ ğ—ğ—ğ–¾ ğ—ğ—ˆğ—‹ğ—…ğ–½ ğ–º ğ–»ğ–¾ğ—ğ—ğ–¾ğ—‹ ğ—‰ğ—…ğ–ºğ–¼ğ–¾! ğŸŒ"},
                {delay: 72, msg: "ğŸ‰ ğ–³ğ—ğ–¾ ğ–¼ğ–¾ğ—…ğ–¾ğ–»ğ—‹ğ–ºğ—ğ—‚ğ—ˆğ—‡ ğ–¼ğ—ˆğ—‡ğ—ğ—‚ğ—‡ğ—ğ–¾ğ—Œ! ğŸ‰"},
                {delay: 75, msg: "â¤ï¸ ğ–³ğ—ğ–ºğ—‡ğ—„ ğ—’ğ—ˆğ— ğ–¿ğ—ˆğ—‹ ğ—ğ—ğ—‚ğ—Œ ğ—ƒğ—ˆğ—’ğ–¿ğ—ğ—… ğ—†ğ—ˆğ—†ğ–¾ğ—‡ğ—! â¤ï¸"},
                {delay: 78, msg: "ğŸ† ğ–¥ğ—‚ğ—‡ğ–ºğ—… ğ–¿ğ—‚ğ—‹ğ–¾ğ—ğ—ˆğ—‹ğ—„ğ—Œ! ğ–¶ğ—ğ–ºğ— ğ–ºğ—‡ ğ–ºğ—†ğ–ºğ—“ğ—‚ğ—‡ğ—€ ğ–¼ğ–¾ğ—…ğ–¾ğ–»ğ—‹ğ–ºğ—ğ—‚ğ—ˆğ—‡! ğŸ†"}
            ];

            let successfulMessages = 0;
            let failedMessages = 0;

            // Send celebration messages with error handling
            for (const {delay, msg} of celebrationMessages) {
                if (!celebrationActive) break;

                try {
                    await new Promise(resolve => setTimeout(resolve, delay * 1000));
                    
                    if (celebrationActive) {
                        const sent = await safeSendMessage(msg);
                        if (sent) {
                            successfulMessages++;
                            console.log(`âœ… ğ–²ğ–¾ğ—‡ğ— ğ–¼ğ–¾ğ—…ğ–¾ğ–»ğ—‹ğ–ºğ—ğ—‚ğ—ˆğ—‡ ğ—†ğ–¾ğ—Œğ—Œğ–ºğ—€ğ–¾: ${msg}`);
                        } else {
                            failedMessages++;
                            console.warn(`âŒ ğ–¥ğ–ºğ—‚ğ—…ğ–¾ğ–½ ğ—ğ—ˆ ğ—Œğ–¾ğ—‡ğ–½: ${msg}`);
                            
                            // If too many consecutive failures, stop celebration
                            if (failedMessages >= 3) {
                                console.error("âŒ ğ–³ğ—ˆğ—ˆ ğ—†ğ–ºğ—‡ğ—’ ğ–¿ğ–ºğ—‚ğ—…ğ—ğ—‹ğ–¾ğ—Œ, ğ—Œğ—ğ—ˆğ—‰ğ—‰ğ—‚ğ—‡ğ—€ ğ–¼ğ–¾ğ—…ğ–¾ğ–»ğ—‹ğ–ºğ—ğ—‚ğ—ˆğ—‡");
                                celebrationActive = false;
                                break;
                            }
                        }
                    }
                } catch (delayError) {
                    console.error("âŒ ğ–£ğ–¾ğ—…ğ–ºğ—’ ğ–¾ğ—‹ğ—‹ğ—ˆğ—‹:", delayError);
                    failedMessages++;
                }
            }

            // Final message
            if (celebrationActive) {
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const finalMessage = 
                    `ğŸŠ ğ–¢ğ–¤ğ–«ğ–¤ğ–¡ğ–±ğ– ğ–³ğ–¨ğ–®ğ–­ ğ–¢ğ–®ğ–¬ğ–¯ğ–«ğ–¤ğ–³ğ–¤! ğŸŠ\n` +
                    "â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n" +
                    `ğ–³ğ—ğ–ºğ—‡ğ—„ğ—Œ ğ–¿ğ—ˆğ—‹ ğ–¼ğ–¾ğ—…ğ–¾ğ–»ğ—‹ğ–ºğ—ğ—‚ğ—‡ğ—€ ğ—ğ—‚ğ—ğ— ğ—ğ—Œ, ${name}! â¤ï¸\n` +
                    "ğ–¸ğ—ˆğ— ğ—†ğ–ºğ–½ğ–¾ ğ—ğ—ğ—‚ğ—Œ ğ—†ğ—ˆğ—†ğ–¾ğ—‡ğ— ğ—Œğ—‰ğ–¾ğ–¼ğ—‚ğ–ºğ—…! ğŸ¥°";
                
                await safeSendMessage(finalMessage);
                console.log(`âœ… ğ–¢ğ–¾ğ—…ğ–¾ğ–»ğ—‹ğ–ºğ—ğ—‚ğ—ˆğ—‡ ğ–¼ğ—ˆğ—†ğ—‰ğ—…ğ–¾ğ—ğ–¾ğ–½ ğ—Œğ—ğ–¼ğ–¼ğ–¾ğ—Œğ—Œğ–¿ğ—ğ—…ğ—…ğ—’! ${successfulMessages}/26 ğ—†ğ–¾ğ—Œğ—Œğ–ºğ—€ğ–¾ğ—Œ ğ—Œğ–¾ğ—‡ğ—`);
            } else {
                console.warn(`âš ï¸ ğ–¢ğ–¾ğ—…ğ–¾ğ–»ğ—‹ğ–ºğ—ğ—‚ğ—ˆğ—‡ ğ—ğ–ºğ—Œ ğ—Œğ—ğ—ˆğ—‰ğ—‰ğ–¾ğ–½ ğ–¾ğ–ºğ—‹ğ—…ğ—’. ${successfulMessages}/26 ğ—†ğ–¾ğ—Œğ—Œğ–ºğ—€ğ–¾ğ—Œ ğ—Œğ–¾ğ—‡ğ—`);
            }

        } catch (error) {
            console.error("ğŸ’¥ ğ–¢ğ–¾ğ—…ğ–¾ğ–»ğ—‹ğ–ºğ—ğ—‚ğ—ˆğ—‡ ğ–¤ğ—‹ğ—‹ğ—ˆğ—‹:", error);
            // Don't send error message to avoid spam
        }
    }
};
